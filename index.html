<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø³ÛŒØ³ØªÙ… Ù…Ø¯ÛŒØ±ÛŒØª Ø´Ø±Ú©Øª Ù…Ø­Ø§ÙØ¸</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* Ø§Ø³ØªØ§ÛŒÙ„ ØµÙØ­Ù‡ Ù„Ø§Ú¯ÛŒÙ† */
        .login-container {
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        .login-card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            width: 100%;
            max-width: 400px;
            padding: 30px;
        }
        .main-system {
            display: none;
        }
        
        /* Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø§ØµÙ„ÛŒ Ø³ÛŒØ³ØªÙ… */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
        }
        .section {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            display: none;
        }
        #guards {
            display: block;
        }
        .guard-item, .shift-item, .incident-item, .leave-item {
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            background: #f8f9fa;
            cursor: pointer;
        }
        .guard-item:hover, .shift-item:hover {
            background: #e9ecef;
        }
        .badge {
            font-size: 0.8em;
            margin: 2px;
        }
        .language-selector {
            width: 150px;
        }
        .profile-photo {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid #dee2e6;
        }
        .list-group-item {
            border: none;
            padding: 15px 20px;
            font-weight: 500;
        }
        .list-group-item.active {
            background-color: #0d6efd;
            border-color: #0d6efd;
        }
        .user-badge {
            background: #28a745;
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8em;
            margin-right: 10px;
        }
        .auto-save-indicator {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #28a745;
            color: white;
            padding: 10px 15px;
            border-radius: 5px;
            display: none;
            z-index: 1000;
        }
        .modal-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        .modal-content {
            background: white;
            padding: 20px;
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
        }
    </style>
     <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
</head>
<body>
    <!-- Ù†Ø´Ø§Ù†Ú¯Ø± Ø°Ø®ÛŒØ±Ù‡ Ø®ÙˆØ¯Ú©Ø§Ø± -->
    <div class="auto-save-indicator" id="saveIndicator">
        <i class="fas fa-check"></i> Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯
    </div>

    <!-- ØµÙØ­Ù‡ Ù„Ø§Ú¯ÛŒÙ† -->
    <div id="loginPage" class="login-container">
        <div class="login-card">
            <div class="text-center mb-4">
                <i class="fas fa-shield-alt fa-3x text-primary mb-3"></i>
                <h3>ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ø³ÛŒØ³ØªÙ…</h3>
                <p class="text-muted">Ù„Ø·ÙØ§ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯</p>
            </div>
            
            <form id="loginForm">
                <div class="mb-3">
                    <label class="form-label">Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ</label>
                    <input type="text" class="form-control" id="username" required>
                </div>
                <div class="mb-3">
                    <label class="form-label">Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±</label>
                    <input type="password" class="form-control" id="password" required>
                </div>
                <button type="submit" class="btn btn-primary w-100 mb-3">
                    <i class="fas fa-sign-in-alt"></i> ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ø³ÛŒØ³ØªÙ…
                </button>
                
                <!-- Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ù†Ù…ÙˆÙ†Ù‡ -->
                <div class="card mt-3">
                    <div class="card-header bg-light">
                        <small><i class="fas fa-info-circle"></i> Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ù†Ù…ÙˆÙ†Ù‡ (Ø¨Ø±Ø§ÛŒ ØªØ³Øª):</small>
                    </div>
                    <div class="card-body">
                        <small class="text-muted">
                            <strong>Admin (Ø§Ø¯Ù…ÛŒÙ†):</strong> admin / 1234<br>
                            <strong>Manager (Ù…Ø¯ÛŒØ±):</strong> manager / 1234<br>
                            <strong>Guard (Ù…Ø­Ø§ÙØ¸):</strong> guard / 1234
                        </small>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- Ø³ÛŒØ³ØªÙ… Ø§ØµÙ„ÛŒ -->
    <div id="mainSystem" class="main-system">
        <!-- Ù†ÙˆØ§Ø± Ø¨Ø§Ù„Ø§ÛŒÛŒ -->
        <nav class="navbar navbar-dark bg-primary">
            <div class="container">
                <span class="navbar-brand mb-0 h1">
                    <i class="fas fa-shield-alt"></i> Ø³ÛŒØ³ØªÙ… Ù…Ø¯ÛŒØ±ÛŒØª Ø´Ø±Ú©Øª Ù…Ø­Ø§ÙØ¸
                    <small class="fs-6 d-block">
                        ğŸ’¾ Ø°Ø®ÛŒØ±Ù‡ Ø®ÙˆØ¯Ú©Ø§Ø± ÙØ¹Ø§Ù„ | 
                        <span id="userWelcome">Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯</span>
                        <span id="userBadge" class="user-badge"></span>
                    </small>
                </span>
                <div class="d-flex align-items-center">
                    <div class="language-selector me-3">
                        <select id="languageSelect" class="form-select form-select-sm">
                            <option value="fa">ÙØ§Ø±Ø³ÛŒ</option>
                            <option value="en">English</option>
                            <option value="ps">Ù¾ÚšØªÙˆ</option>
                        </select>
                    </div>
                    <button class="btn btn-outline-light btn-sm" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i> Ø®Ø±ÙˆØ¬
                    </button>
                </div>
            </div>
        </nav>

        <div class="container mt-4">
            <div class="row">
                <!-- Ù…Ù†ÙˆÛŒ Ú©Ù†Ø§Ø±ÛŒ -->
                <div class="col-md-3">
                    <div class="list-group">
                        <a href="#guards" class="list-group-item list-group-item-action active">
                            <i class="fas fa-users"></i> Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ø­Ø§ÙØ¸Ø§Ù†
                        </a>
                        <a href="#shifts" class="list-group-item list-group-item-action">
                            <i class="fas fa-calendar-alt"></i> Ù…Ø¯ÛŒØ±ÛŒØª Ø´ÛŒÙØªâ€ŒÙ‡Ø§
                        </a>
                        <a href="#incidents" class="list-group-item list-group-item-action">
                            <i class="fas fa-exclamation-triangle"></i> Ú¯Ø²Ø§Ø±Ø´ Ø­ÙˆØ§Ø¯Ø«
                        </a>
                        <a href="#leaves" class="list-group-item list-group-item-action">
                            <i class="fas fa-umbrella-beach"></i> Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ø±Ø®ØµÛŒ
                        </a>
                        <a href="#reports" class="list-group-item list-group-item-action">
                            <i class="fas fa-chart-bar"></i> Ú¯Ø²Ø§Ø±Ø´Ø§Øª
                        </a>
                        
                        <!-- Ù…Ù†ÙˆÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ø¨Ø±Ø§ÛŒ Ø§Ø¯Ù…ÛŒÙ† -->
                        <div id="adminMenu" style="display: none;">
                            <hr>
                            <a href="#users" class="list-group-item list-group-item-action">
                                <i class="fas fa-user-cog"></i> Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø§Ø±Ø¨Ø±Ø§Ù†
                            </a>
                            <a href="#settings" class="list-group-item list-group-item-action">
                                <i class="fas fa-cogs"></i> ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø³ÛŒØ³ØªÙ…
                            </a>
                        </div>
                    </div>
                </div>

                <!-- Ù…Ø­ØªÙˆØ§ÛŒ Ø§ØµÙ„ÛŒ -->
                <div class="col-md-9">
                    <!-- Ø¨Ø®Ø´ Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ø­Ø§ÙØ¸Ø§Ù† -->
                    <div id="guards" class="section">
                        <h4><i class="fas fa-user-plus"></i> Ø«Ø¨Øª Ù…Ø­Ø§ÙØ¸ Ø¬Ø¯ÛŒØ¯</h4>
                        <form id="guardForm" class="row g-3">
                            <div class="col-md-4">
                                <label class="form-label">Ù†Ø§Ù…</label>
                                <input type="text" class="form-control" id="firstName" required>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">ØªØ®Ù„Øµ</label>
                                <input type="text" class="form-control" id="lastName" required>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">Ù†Ø§Ù… Ù¾Ø¯Ø±</label>
                                <input type="text" class="form-control" id="fatherName" required>
                            </div>
                            
                            <div class="col-md-6">
                                <label class="form-label">Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³</label>
                                <input type="text" class="form-control" id="phoneNumber" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Ø±ØªØ¨Ù‡</label>
                                <select class="form-select" id="position" required>
                                    <option value="Officer">Ø§ÙØ³Ø± - Officer</option>
                                    <option value="Second_Lieutenant">Ø³Ø§ØªÙ†Ù…Ù† - Second Lieutenant</option>
                                    <option value="First_Lieutenant">Ù„ÙˆÙ…Ú“ÛŒ Ø³Ø§ØªÙ†Ù…Ù† - First Lieutenant</option>
                                    <option value="Second_Lieutenant_Junior">Ø¯ÙˆÛŒÙ… Ø³Ø§ØªÙ†Ù…Ù† - Second Lieutenant (Junior)</option>
                                    <option value="Guard">Ú«Ø§Ø±Ø¯ - Guard (Private)</option>
                                </select>
                            </div>
                            
                            <div class="col-md-6">
                                <label class="form-label">ØªØ§Ø±ÛŒØ® Ø§Ø³ØªØ®Ø¯Ø§Ù…</label>
                                <input type="date" class="form-control" id="hireDate" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Ø¹Ú©Ø³ Ù¾Ø±ÙˆÙØ§ÛŒÙ„ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)</label>
                                <input type="file" class="form-control" id="profilePhoto" accept="image/*">
                            </div>
                            
                            <div class="col-12">
                                <button type="submit" class="btn btn-success">
                                    <i class="fas fa-save"></i> Ø«Ø¨Øª Ù…Ø­Ø§ÙØ¸
                                </button>
                                <button type="button" id="cancelEdit" class="btn btn-secondary" style="display: none;">
                                    <i class="fas fa-times"></i> Ù„ØºÙˆ ÙˆÛŒØ±Ø§ÛŒØ´
                                </button>
                            </div>
                        </form>

                        <hr>
                        <h5><i class="fas fa-list"></i> Ù„ÛŒØ³Øª Ù…Ø­Ø§ÙØ¸Ø§Ù†</h5>
                        <div id="guardsList" class="mt-3"></div>
                    </div>

                    <!-- Ø¨Ø®Ø´ Ù…Ø¯ÛŒØ±ÛŒØª Ø´ÛŒÙØªâ€ŒÙ‡Ø§ -->
                    <div id="shifts" class="section">
                        <h4><i class="fas fa-calendar-plus"></i> Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒØ±ÛŒØ²ÛŒ Ø´ÛŒÙØª Ø¬Ø¯ÛŒØ¯</h4>
                        <form id="shiftForm" class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label">Ø§Ù†ØªØ®Ø§Ø¨ Ù…Ø­Ø§ÙØ¸</label>
                                <select class="form-select" id="shiftGuard" required>
                                    <option value="">Ø§Ù†ØªØ®Ø§Ø¨ Ù…Ø­Ø§ÙØ¸...</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">ØªØ§Ø±ÛŒØ® Ø´ÛŒÙØª</label>
                                <input type="date" class="form-control" id="shiftDate" required>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">Ø²Ù…Ø§Ù† Ø´Ø±ÙˆØ¹</label>
                                <input type="time" class="form-control" id="startTime" required>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">Ø²Ù…Ø§Ù† Ù¾Ø§ÛŒØ§Ù†</label>
                                <input type="time" class="form-control" id="endTime" required>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">Ù†ÙˆØ¹ Ø´ÛŒÙØª</label>
                                <select class="form-select" id="shiftType" required>
                                    <option value="Day">Ø´ÛŒÙØª Ø±ÙˆØ²</option>
                                    <option value="Night">Ø´ÛŒÙØª Ø´Ø¨</option>
                                    <option value="Day-Night">Ø´ÛŒÙØª Ø±ÙˆØ² Ùˆ Ø´Ø¨</option>
                                </select>
                            </div>
                            <div class="col-12">
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-plus"></i> Ø§ÙØ²ÙˆØ¯Ù† Ø´ÛŒÙØª
                                </button>
                            </div>
                        </form>

                        <hr>
                        <h5><i class="fas fa-calendar-day"></i> Ø´ÛŒÙØªâ€ŒÙ‡Ø§ÛŒ Ø§Ù…Ø±ÙˆØ²</h5>
                        <div id="shiftsList" class="mt-3"></div>
                    </div>

                    <!-- Ø¨Ø®Ø´ Ú¯Ø²Ø§Ø±Ø´ Ø­ÙˆØ§Ø¯Ø« -->
                    <div id="incidents" class="section">
                        <h4><i class="fas fa-exclamation-circle"></i> Ú¯Ø²Ø§Ø±Ø´ Ø­Ø§Ø¯Ø«Ù‡ Ø¬Ø¯ÛŒØ¯</h4>
                        <form id="incidentForm" class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label">Ù…Ø­Ø§ÙØ¸ Ù…Ø³Ø¦ÙˆÙ„</label>
                                <select class="form-select" id="incidentGuard" required>
                                    <option value="">Ø§Ù†ØªØ®Ø§Ø¨ Ù…Ø­Ø§ÙØ¸...</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">ØªØ§Ø±ÛŒØ® Ùˆ Ø²Ù…Ø§Ù† Ø­Ø§Ø¯Ø«Ù‡</label>
                                <input type="datetime-local" class="form-control" id="incidentDateTime" required>
                            </div>
                            <div class="col-12">
                                <label class="form-label">Ø¹Ù†ÙˆØ§Ù† Ø­Ø§Ø¯Ø«Ù‡</label>
                                <input type="text" class="form-control" id="incidentTitle" required>
                            </div>
                            <div class="col-12">
                                <label class="form-label">Ø´Ø±Ø­ Ú©Ø§Ù…Ù„ Ø­Ø§Ø¯Ø«Ù‡</label>
                                <textarea class="form-control" id="incidentDescription" rows="3" required></textarea>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Ø³Ø·Ø­ Ø§Ù‡Ù…ÛŒØª</label>
                                <select class="form-select" id="incidentSeverity" required>
                                    <option value="Low">Ú©Ù…</option>
                                    <option value="Medium">Ù…ØªÙˆØ³Ø·</option>
                                    <option value="High">Ø²ÛŒØ§Ø¯</option>
                                    <option value="Critical">Ø¨Ø­Ø±Ø§Ù†ÛŒ</option>
                                </select>
                            </div>
                            <div class="col-12">
                                <button type="submit" class="btn btn-warning">
                                    <i class="fas fa-exclamation-triangle"></i> Ø«Ø¨Øª Ø­Ø§Ø¯Ø«Ù‡
                                </button>
                            </div>
                        </form>

                        <hr>
                        <h5><i class="fas fa-history"></i> ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ø­ÙˆØ§Ø¯Ø«</h5>
                        <div id="incidentsList" class="mt-3"></div>
                    </div>

                    <!-- Ø¨Ø®Ø´ Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ø±Ø®ØµÛŒ -->
                    <div id="leaves" class="section">
                        <h4><i class="fas fa-file-signature"></i> Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù…Ø±Ø®ØµÛŒ Ø¬Ø¯ÛŒØ¯</h4>
                        <form id="leaveForm" class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label">Ù…Ø­Ø§ÙØ¸</label>
                                <select class="form-select" id="leaveGuard" required>
                                    <option value="">Ø§Ù†ØªØ®Ø§Ø¨ Ù…Ø­Ø§ÙØ¸...</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Ù†ÙˆØ¹ Ù…Ø±Ø®ØµÛŒ</label>
                                <select class="form-select" id="leaveType" required>
                                    <option value="Annual">Ù…Ø±Ø®ØµÛŒ Ø±ÙˆØ²Ø§Ù†Ù‡</option>
                                    <option value="Sick">Ù…Ø±Ø®ØµÛŒ Ù…Ø±ÛŒØ¶ÛŒ</option>
                                    <option value="Emergency">Ù…Ø±Ø®ØµÛŒ Ø§Ø¶Ø·Ø±Ø§Ø±ÛŒ</option>
                                    <option value="Maternity">Ù…Ø±Ø®ØµÛŒ Ø²Ø§ÛŒÙ…Ø§Ù†</option>
                                    <option value="Paternity">Ù…Ø±Ø®ØµÛŒ Ù¾Ø¯Ø±ÛŒ</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">ØªØ§Ø±ÛŒØ® Ø´Ø±ÙˆØ¹</label>
                                <input type="date" class="form-control" id="leaveStart" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">ØªØ§Ø±ÛŒØ® Ù¾Ø§ÛŒØ§Ù†</label>
                                <input type="date" class="form-control" id="leaveEnd" required>
                            </div>
                            <div class="col-12">
                                <label class="form-label">Ø¹Ù„Øª Ù…Ø±Ø®ØµÛŒ</label>
                                <textarea class="form-control" id="leaveReason" rows="2" required></textarea>
                            </div>
                            <div class="col-12">
                                <button type="submit" class="btn btn-info">
                                    <i class="fas fa-paper-plane"></i> Ø«Ø¨Øª Ø¯Ø±Ø®ÙˆØ§Ø³Øª
                                </button>
                            </div>
                        </form>

                        <hr>
                        <h5><i class="fas fa-clipboard-list"></i> Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ Ù…Ø±Ø®ØµÛŒ</h5>
                        <div id="leavesList" class="mt-3"></div>
                    </div>

                    <!-- Ø¨Ø®Ø´ Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø§Ø±Ø¨Ø±Ø§Ù† (ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ Ø§Ø¯Ù…ÛŒÙ†) -->
                    <div id="users" class="section">
                        <h4><i class="fas fa-user-cog"></i> Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø³ÛŒØ³ØªÙ…</h4>
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle"></i>
                            Ø§ÛŒÙ† Ø¨Ø®Ø´ ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø¨Ø§ Ø¯Ø³ØªØ±Ø³ÛŒ Ø§Ø¯Ù…ÛŒÙ† Ù‚Ø§Ø¨Ù„ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø§Ø³Øª.
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header bg-primary text-white">
                                        <i class="fas fa-user-plus"></i> Ø§ÙØ²ÙˆØ¯Ù† Ú©Ø§Ø±Ø¨Ø± Ø¬Ø¯ÛŒØ¯
                                    </div>
                                    <div class="card-body">
                                        <form id="userForm">
                                            <div class="mb-3">
                                                <label class="form-label">Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ</label>
                                                <input type="text" class="form-control" id="newUsername" required>
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label">Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±</label>
                                                <input type="password" class="form-control" id="newPassword" required>
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label">Ù†Ø§Ù… Ú©Ø§Ù…Ù„</label>
                                                <input type="text" class="form-control" id="newName" required>
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label">Ø³Ø·Ø­ Ø¯Ø³ØªØ±Ø³ÛŒ</label>
                                                <select class="form-select" id="userRole" required>
                                                    <option value="admin">Ø§Ø¯Ù…ÛŒÙ† (Ø¯Ø³ØªØ±Ø³ÛŒ Ú©Ø§Ù…Ù„)</option>
                                                    <option value="manager">Ù…Ø¯ÛŒØ± (Ù…Ø¯ÛŒØ±ÛŒØª Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§)</option>
                                                    <option value="guard">Ù…Ø­Ø§ÙØ¸ (Ù…Ø´Ø§Ù‡Ø¯Ù‡ ÙÙ‚Ø·)</option>
                                                </select>
                                            </div>
                                            <button type="submit" class="btn btn-success w-100">
                                                <i class="fas fa-user-plus"></i> Ø§ÙØ²ÙˆØ¯Ù† Ú©Ø§Ø±Ø¨Ø±
                                            </button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header bg-secondary text-white">
                                        <i class="fas fa-users"></i> Ù„ÛŒØ³Øª Ú©Ø§Ø±Ø¨Ø±Ø§Ù†
                                    </div>
                                    <div class="card-body">
                                        <div id="usersList"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Ø¨Ø®Ø´ Ú¯Ø²Ø§Ø±Ø´Ø§Øª -->
                    <div id="reports" class="section">
                        <h4><i class="fas fa-chart-pie"></i> Ú¯Ø²Ø§Ø±Ø´Ø§Øª Ø³ÛŒØ³ØªÙ…</h4>
                        
                        <div class="row mb-4">
                            <div class="col-md-3">
                                <div class="card text-white bg-primary">
                                    <div class="card-body text-center">
                                        <h3 id="totalGuards">0</h3>
                                        <p>ØªØ¹Ø¯Ø§Ø¯ Ú©Ù„ Ù…Ø­Ø§ÙØ¸Ø§Ù†</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card text-white bg-success">
                                    <div class="card-body text-center">
                                        <h3 id="todayShifts">0</h3>
                                        <p>Ø´ÛŒÙØªâ€ŒÙ‡Ø§ÛŒ Ø§Ù…Ø±ÙˆØ²</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card text-white bg-warning">
                                    <div class="card-body text-center">
                                        <h3 id="totalIncidents">0</h3>
                                        <p>Ø­ÙˆØ§Ø¯Ø« Ø«Ø¨Øª Ø´Ø¯Ù‡</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card text-white bg-info">
                                    <div class="card-body text-center">
                                        <h3 id="pendingLeaves">0</h3>
                                        <p>Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ Ù…Ø±Ø®ØµÛŒ</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Ø¨Ø®Ø´ Ù…Ø¯ÛŒØ±ÛŒØª Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ -->
                        <div class="card mt-4">
                            <div class="card-header bg-dark text-white">
                                <i class="fas fa-database"></i> Ù…Ø¯ÛŒØ±ÛŒØª Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <h6>Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§</h6>
                                        <p class="text-muted">Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ…Ù†â€ŒØ³Ø§Ø²ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ØŒ Ø§Ø² Ø¢Ù†â€ŒÙ‡Ø§ Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ø¨Ú¯ÛŒØ±ÛŒØ¯.</p>
                                        <button class="btn btn-success" onclick="exportData()">
                                            <i class="fas fa-download"></i> Ø¯Ø±ÛŒØ§ÙØª Ù¾Ø´ØªÛŒØ¨Ø§Ù† (Export)
                                        </button>
                                    </div>
                                    <div class="col-md-6">
                                        <h6>Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§</h6>
                                        <p class="text-muted">Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù‚Ø¨Ù„ÛŒ Ø±Ø§ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ú©Ù†ÛŒØ¯.</p>
                                        <button class="btn btn-warning" onclick="document.getElementById('importFile').click()">
                                            <i class="fas fa-upload"></i> Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù¾Ø´ØªÛŒØ¨Ø§Ù† (Import)
                                        </button>
                                        <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importData(event)">
                                    </div>
                                </div>
                                <div class="row mt-3">
                                    <div class="col-12">
                                        <button class="btn btn-danger" onclick="clearAllData()">
                                            <i class="fas fa-trash"></i> Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù‡Ù…Ù‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
                                        </button>
                                        <small class="text-muted d-block mt-1">âš ï¸ Ø§ÛŒÙ† Ø¹Ù…Ù„ Ù‚Ø§Ø¨Ù„ Ø¨Ø§Ø²Ú¯Ø´Øª Ù†ÛŒØ³Øª!</small>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row mt-4">
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <i class="fas fa-chart-bar"></i> ØªÙˆØ²ÛŒØ¹ Ù…Ø­Ø§ÙØ¸Ø§Ù† Ø¨Ø± Ø§Ø³Ø§Ø³ Ø±ØªØ¨Ù‡
                                    </div>
                                    <div class="card-body">
                                        <div id="positionChart"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <i class="fas fa-chart-line"></i> ÙØ¹Ø§Ù„ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ø§Ø®ÛŒØ±
                                    </div>
                                    <div class="card-body">
                                        <div id="activityChart"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Ø¨Ø®Ø´ ØªÙ†Ø¸ÛŒÙ…Ø§Øª -->
                    <div id="settings" class="section">
                        <h4><i class="fas fa-cogs"></i> ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø³ÛŒØ³ØªÙ…</h4>
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle"></i>
                            Ø§ÛŒÙ† Ø¨Ø®Ø´ ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø¨Ø§ Ø¯Ø³ØªØ±Ø³ÛŒ Ø§Ø¯Ù…ÛŒÙ† Ù‚Ø§Ø¨Ù„ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø§Ø³Øª.
                        </div>
                        <div class="card">
                            <div class="card-header">ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¹Ù…ÙˆÙ…ÛŒ</div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <label class="form-label">Ù†Ø§Ù… Ø´Ø±Ú©Øª</label>
                                    <input type="text" class="form-control" id="companyName" value="Ø´Ø±Ú©Øª Ù…Ø­Ø§ÙØ¸">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Ø²Ø¨Ø§Ù† Ù¾ÛŒØ´â€ŒÙØ±Ø¶</label>
                                    <select class="form-select" id="defaultLanguage">
                                        <option value="fa">ÙØ§Ø±Ø³ÛŒ</option>
                                        <option value="en">English</option>
                                        <option value="ps">Ù¾ÚšØªÙˆ</option>
                                    </select>
                                </div>
                                <button class="btn btn-primary" onclick="saveSettings()">
                                    <i class="fas fa-save"></i> Ø°Ø®ÛŒØ±Ù‡ ØªÙ†Ø¸ÛŒÙ…Ø§Øª
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ==================== Ø³ÛŒØ³ØªÙ… Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª Ùˆ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† ====================
        
        let currentUser = null;
        let users = [
            { id: 1, username: 'admin', password: '1234', role: 'admin', name: 'Ù…Ø¯ÛŒØ± Ø³ÛŒØ³ØªÙ…' },
            { id: 2, username: 'manager', password: '1234', role: 'manager', name: 'Ù…Ø¯ÛŒØ± Ø¹Ù…Ù„ÛŒØ§Øª' },
            { id: 3, username: 'guard', password: '1234', role: 'guard', name: 'Ù…Ø­Ø§ÙØ¸ Ù†Ù…ÙˆÙ†Ù‡' }
        ];

        // ==================== Ø³ÛŒØ³ØªÙ… Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø± ====================
        
        let guards = [];
        let shifts = [];
        let incidents = [];
        let leaves = [];
        let currentEditId = null;

        // ÙˆÙ‚ØªÛŒ ØµÙØ­Ù‡ Ù„ÙˆØ¯ Ø´Ø¯
        document.addEventListener('DOMContentLoaded', function() {
            // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø§Ø² localStorage
            const savedUsers = localStorage.getItem('systemUsers');
            if (savedUsers) {
                const parsedUsers = JSON.parse(savedUsers);
                if (Array.isArray(parsedUsers)) {
                    users = parsedUsers;
                }
            }
            
            // Ú†Ú© Ú©Ø±Ø¯Ù† Ø§Ú¯Ø± Ú©Ø§Ø±Ø¨Ø± Ù‚Ø¨Ù„Ø§Ù‹ Ù„Ø§Ú¯ÛŒÙ† Ú©Ø±Ø¯Ù‡
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                try {
                    currentUser = JSON.parse(savedUser);
                    showMainSystem();
                } catch (e) {
                    showLoginPage();
                }
            } else {
                showLoginPage();
            }

            setupLoginForm();
        });

        // Ù†Ù…Ø§ÛŒØ´ ØµÙØ­Ù‡ Ù„Ø§Ú¯ÛŒÙ†
        function showLoginPage() {
            document.getElementById('loginPage').style.display = 'flex';
            document.getElementById('mainSystem').style.display = 'none';
        }

        // Ù†Ù…Ø§ÛŒØ´ Ø³ÛŒØ³ØªÙ… Ø§ØµÙ„ÛŒ
        function showMainSystem() {
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('mainSystem').style.display = 'block';
            
            // Ø¨Ù‡ Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø±
            document.getElementById('userWelcome').textContent = `Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯ ${currentUser.name}`;
            document.getElementById('userBadge').textContent = getRoleText(currentUser.role);
            
            // Ù…Ø¯ÛŒØ±ÛŒØª Ø¯Ø³ØªØ±Ø³ÛŒâ€ŒÙ‡Ø§ Ø¨Ø± Ø§Ø³Ø§Ø³ Ù†Ù‚Ø´ Ú©Ø§Ø±Ø¨Ø±
            manageUserAccess();
            
            // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø³ÛŒØ³ØªÙ…
            loadAllData();
            setupNavigation();
            setupForms();
            setupLanguageSelector();
            showSection('guards');
        }

        // Ù…Ø¯ÛŒØ±ÛŒØª Ø¯Ø³ØªØ±Ø³ÛŒâ€ŒÙ‡Ø§
        function manageUserAccess() {
            const adminMenu = document.getElementById('adminMenu');
            const usersSection = document.getElementById('users');
            const settingsSection = document.getElementById('settings');
            
            if (currentUser.role === 'admin') {
                adminMenu.style.display = 'block';
            } else {
                adminMenu.style.display = 'none';
                usersSection.style.display = 'none';
                settingsSection.style.display = 'none';
            }
        }

        // ÙØ±Ù… Ù„Ø§Ú¯ÛŒÙ†
        function setupLoginForm() {
            document.getElementById('loginForm').addEventListener('submit', function(e) {
                e.preventDefault();
                login();
            });
        }

        // Ø¹Ù…Ù„ÛŒØ§Øª Ù„Ø§Ú¯ÛŒÙ†
        function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            const user = users.find(u => u.username === username && u.password === password);
            
            if (user) {
                currentUser = user;
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                showMainSystem();
            } else {
                alert('âŒ Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ ÛŒØ§ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø§Ø´ØªØ¨Ø§Ù‡ Ø§Ø³Øª!');
            }
        }

        // Ø®Ø±ÙˆØ¬ Ø§Ø² Ø³ÛŒØ³ØªÙ…
        function logout() {
            if (confirm('Ø¢ÛŒØ§ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø§Ø² Ø³ÛŒØ³ØªÙ… Ø®Ø§Ø±Ø¬ Ø´ÙˆÛŒØ¯ØŸ')) {
                currentUser = null;
                localStorage.removeItem('currentUser');
                showLoginPage();
                document.getElementById('loginForm').reset();
            }
        }

        // Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø§Ø±Ø¨Ø±Ø§Ù† (ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ Ø§Ø¯Ù…ÛŒÙ†)
        function setupUserManagement() {
            document.getElementById('userForm').addEventListener('submit', function(e) {
                e.preventDefault();
                addUser();
            });
            loadUsersList();
        }

        function addUser() {
            if (currentUser.role !== 'admin') {
                alert('âŒ ÙÙ‚Ø· Ø§Ø¯Ù…ÛŒÙ† Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ú©Ø§Ø±Ø¨Ø± Ø¬Ø¯ÛŒØ¯ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†Ø¯!');
                return;
            }

            const username = document.getElementById('newUsername').value;
            const password = document.getElementById('newPassword').value;
            const name = document.getElementById('newName').value;
            const role = document.getElementById('userRole').value;

            if (!username || !password || !name) {
                alert('âŒ Ù„Ø·ÙØ§ ØªÙ…Ø§Ù… ÙÛŒÙ„Ø¯Ù‡Ø§ Ø±Ø§ Ù¾Ø± Ú©Ù†ÛŒØ¯!');
                return;
            }

            // Ú†Ú© Ú©Ø±Ø¯Ù† ØªÚ©Ø±Ø§Ø±ÛŒ Ù†Ø¨ÙˆØ¯Ù† Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ
            if (users.find(u => u.username === username)) {
                alert('âŒ Ø§ÛŒÙ† Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ Ù‚Ø¨Ù„Ø§Ù‹ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø´Ø¯Ù‡ Ø§Ø³Øª!');
                return;
            }

            const newUser = {
                id: users.length > 0 ? Math.max(...users.map(u => u.id)) + 1 : 1,
                username: username,
                password: password,
                role: role,
                name: name
            };

            users.push(newUser);
            localStorage.setItem('systemUsers', JSON.stringify(users));
            document.getElementById('userForm').reset();
            loadUsersList();
            alert('âœ… Ú©Ø§Ø±Ø¨Ø± Ø¬Ø¯ÛŒØ¯ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯!');
        }

        function loadUsersList() {
            const container = document.getElementById('usersList');
            container.innerHTML = '';

            if (users.length === 0) {
                container.innerHTML = '<p class="text-muted">Ù‡ÛŒÚ† Ú©Ø§Ø±Ø¨Ø±ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯.</p>';
                return;
            }

            users.forEach(user => {
                const userItem = document.createElement('div');
                userItem.className = 'd-flex justify-content-between align-items-center border-bottom py-2';
                userItem.innerHTML = `
                    <div>
                        <strong>${user.username}</strong>
                        <br>
                        <small class="text-muted">${user.name} - ${getRoleText(user.role)}</small>
                    </div>
                    <div>
                        ${user.id > 3 ? `<button class="btn btn-sm btn-outline-danger" onclick="deleteUser(${user.id})">
                            <i class="fas fa-trash"></i>
                        </button>` : '<small class="text-muted">Ú©Ø§Ø±Ø¨Ø± Ø³ÛŒØ³ØªÙ…ÛŒ</small>'}
                    </div>
                `;
                container.appendChild(userItem);
            });
        }

        function deleteUser(id) {
            if (currentUser.role !== 'admin') {
                alert('âŒ ÙÙ‚Ø· Ø§Ø¯Ù…ÛŒÙ† Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø±Ø§ Ø­Ø°Ù Ú©Ù†Ø¯!');
                return;
            }

            if (id <= 3) {
                alert('âŒ Ù†Ù…ÛŒâ€ŒØªÙˆØ§Ù† Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø³ÛŒØ³ØªÙ…ÛŒ Ø±Ø§ Ø­Ø°Ù Ú©Ø±Ø¯!');
                return;
            }

            if (confirm('âš ï¸ Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ø§ÛŒÙ† Ú©Ø§Ø±Ø¨Ø± Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ')) {
                users = users.filter(user => user.id !== id);
                localStorage.setItem('systemUsers', JSON.stringify(users));
                loadUsersList();
                alert('ğŸ—‘ï¸ Ú©Ø§Ø±Ø¨Ø± Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø­Ø°Ù Ø´Ø¯!');
            }
        }

        // ==================== Ø³ÛŒØ³ØªÙ… Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ ====================

        // Ø°Ø®ÛŒØ±Ù‡ Ù‡Ù…Ù‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø¯Ø± Local Storage
        function saveAllData() {
            try {
                localStorage.setItem('guardsData', JSON.stringify(guards));
                localStorage.setItem('shiftsData', JSON.stringify(shifts));
                localStorage.setItem('incidentsData', JSON.stringify(incidents));
                localStorage.setItem('leavesData', JSON.stringify(leaves));
                
                // Ù†Ù…Ø§ÛŒØ´ Ù†Ø´Ø§Ù†Ú¯Ø± Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ
                showSaveIndicator();
                
                console.log('ğŸ’¾ Ù‡Ù…Ù‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù†Ø¯!');
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ:', error);
            }
        }

        // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù‡Ù…Ù‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø§Ø² Local Storage
        function loadAllData() {
            try {
                const savedGuards = localStorage.getItem('guardsData');
                const savedShifts = localStorage.getItem('shiftsData');
                const savedIncidents = localStorage.getItem('incidentsData');
                const savedLeaves = localStorage.getItem('leavesData');
                
                if (savedGuards) guards = JSON.parse(savedGuards);
                if (savedShifts) shifts = JSON.parse(savedShifts);
                if (savedIncidents) incidents = JSON.parse(savedIncidents);
                if (savedLeaves) leaves = JSON.parse(savedLeaves);
                
                // Ø§Ú¯Ø± Ø¯Ø§Ø¯Ù‡â€ŒØ§ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯ØŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù†Ù…ÙˆÙ†Ù‡ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†
                if (guards.length === 0) {
                    guards = [
                        { 
                            id: 1, 
                            firstName: "Ø°Ø¨ÛŒØ­ Ø§Ù„Ù„Ù‡", 
                            lastName: "Ø§Ø­Ù…Ø¯Ø²ÛŒ",
                            fatherName: "Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡",
                            phone: "0780060833", 
                            hireDate: "2021-01-10", 
                            position: "Officer",
                            profilePhoto: null
                        }
                    ];
                    saveAllData();
                }
                
                console.log('ğŸ“‚ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯Ù†Ø¯!');
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§:', error);
            }
        }

        // Ù†Ù…Ø§ÛŒØ´ Ù†Ø´Ø§Ù†Ú¯Ø± Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ
        function showSaveIndicator() {
            const indicator = document.getElementById('saveIndicator');
            indicator.style.display = 'block';
            setTimeout(() => {
                indicator.style.display = 'none';
            }, 2000);
        }

        // ==================== Ù…Ø¯ÛŒØ±ÛŒØª Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ ====================

        // Export Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø¨Ù‡ ÙØ§ÛŒÙ„ JSON
        function exportData() {
            try {
                const allData = {
                    guards: guards,
                    shifts: shifts,
                    incidents: incidents,
                    leaves: leaves,
                    users: users,
                    exportDate: new Date().toLocaleString('fa-IR'),
                    version: '1.0'
                };
                
                const dataStr = JSON.stringify(allData, null, 2);
                const dataBlob = new Blob([dataStr], {type: 'application/json'});
                
                const link = document.createElement('a');
                link.href = URL.createObjectURL(dataBlob);
                link.download = `security-company-backup-${new Date().toISOString().split('T')[0]}.json`;
                link.click();
                
                alert('âœ… Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª export Ø´Ø¯Ù†Ø¯!');
            } catch (error) {
                alert('âŒ Ø®Ø·Ø§ Ø¯Ø± export Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§!');
            }
        }

        // Import Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø§Ø² ÙØ§ÛŒÙ„ JSON
        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    
                    if (confirm('âš ï¸ Ø¢ÛŒØ§ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ ÙØ¹Ù„ÛŒ Ø¨Ø§ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ import Ø´Ø¯Ù‡ Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† Ø´ÙˆÙ†Ø¯ØŸ\nØ§ÛŒÙ† Ø¹Ù…Ù„ Ù‚Ø§Ø¨Ù„ Ø¨Ø§Ø²Ú¯Ø´Øª Ù†ÛŒØ³Øª!')) {
                        guards = importedData.guards || [];
                        shifts = importedData.shifts || [];
                        incidents = importedData.incidents || [];
                        leaves = importedData.leaves || [];
                        users = importedData.users || users;
                        
                        localStorage.setItem('systemUsers', JSON.stringify(users));
                        saveAllData();
                        loadGuardsList();
                        alert('âœ… Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª import Ø´Ø¯Ù†Ø¯!');
                    }
                } catch (error) {
                    alert('âŒ ÙØ§ÛŒÙ„ Ù…Ø¹ØªØ¨Ø± Ù†ÛŒØ³Øª! Ù„Ø·ÙØ§Ù‹ ÛŒÚ© ÙØ§ÛŒÙ„ JSON Ù…Ø¹ØªØ¨Ø± Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.');
                }
            };
            reader.readAsText(file);
            
            // Reset file input
            event.target.value = '';
        }

        // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù‡Ù…Ù‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
        function clearAllData() {
            if (confirm('âš ï¸ âš ï¸ âš ï¸\nØ¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ù‡Ù…Ù‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø±Ø§ Ù¾Ø§Ú© Ú©Ù†ÛŒØ¯ØŸ\nØ§ÛŒÙ† Ø¹Ù…Ù„ Ù‚Ø§Ø¨Ù„ Ø¨Ø§Ø²Ú¯Ø´Øª Ù†ÛŒØ³Øª!')) {
                if (confirm('âŒ Ø¢Ø®Ø±ÛŒÙ† Ù‡Ø´Ø¯Ø§Ø±!\nÙ‡Ù…Ù‡ Ù…Ø­Ø§ÙØ¸Ø§Ù†ØŒ Ø´ÛŒÙØªâ€ŒÙ‡Ø§ØŒ Ø­ÙˆØ§Ø¯Ø« Ùˆ Ù…Ø±Ø®ØµÛŒâ€ŒÙ‡Ø§ Ù¾Ø§Ú© Ø®ÙˆØ§Ù‡Ù†Ø¯ Ø´Ø¯!')) {
                    guards = [];
                    shifts = [];
                    incidents = [];
                    leaves = [];
                    
                    saveAllData();
                    loadGuardsList();
                    alert('ğŸ—‘ï¸ Ù‡Ù…Ù‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ù¾Ø§Ú© Ø´Ø¯Ù†Ø¯!');
                }
            }
        }

        // ==================== Ø¨Ù‚ÛŒÙ‡ ØªÙˆØ§Ø¨Ø¹ Ø³ÛŒØ³ØªÙ… ====================

        // ØªÙ†Ø¸ÛŒÙ… Ù†ÙˆÛŒÚ¯ÛŒØ´Ù†
        function setupNavigation() {
            const navLinks = document.querySelectorAll('.list-group-item');
            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const target = this.getAttribute('href').substring(1);
                    showSection(target);
                    
                    navLinks.forEach(l => l.classList.remove('active'));
                    this.classList.add('active');
                });
            });
        }

        // Ù†Ù…Ø§ÛŒØ´ Ø¨Ø®Ø´ Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø±
        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(section => {
                section.style.display = 'none';
            });
            
            const targetSection = document.getElementById(sectionId);
            if (targetSection) {
                targetSection.style.display = 'block';
            }
            
            // Ù„ÙˆØ¯ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ø±Ø¨ÙˆØ·Ù‡
            if (sectionId === 'guards') {
                loadGuardsList();
            } else if (sectionId === 'shifts') {
                loadShiftsSection();
            } else if (sectionId === 'incidents') {
                loadIncidentsSection();
            } else if (sectionId === 'leaves') {
                loadLeavesSection();
            } else if (sectionId === 'users') {
                setupUserManagement();
            } else if (sectionId === 'reports') {
                loadReportsSection();
            }
        }

        // ØªÙ†Ø¸ÛŒÙ… Ø§Ù†ØªØ®Ø§Ø¨ Ø²Ø¨Ø§Ù†
        function setupLanguageSelector() {
            const languageSelect = document.getElementById('languageSelect');
            languageSelect.addEventListener('change', function() {
                changeLanguage(this.value);
            });
        }

        // ØªØºÛŒÛŒØ± Ø²Ø¨Ø§Ù†
        function changeLanguage(lang) {
            alert('Ø²Ø¨Ø§Ù† Ø¨Ù‡ ' + (lang === 'fa' ? 'ÙØ§Ø±Ø³ÛŒ' : lang === 'en' ? 'English' : 'Ù¾ÚšØªÙˆ') + ' ØªØºÛŒÛŒØ± Ú©Ø±Ø¯');
        }

        // Ù¾Ø± Ú©Ø±Ø¯Ù† Ø¯Ø±Ø§Ù¾â€ŒØ¯Ø§ÙˆÙ† Ù…Ø­Ø§ÙØ¸Ø§Ù†
        function populateGuardDropdown(selectId) {
            const select = document.getElementById(selectId);
            select.innerHTML = '<option value="">Ø§Ù†ØªØ®Ø§Ø¨ Ù…Ø­Ø§ÙØ¸...</option>';
            guards.forEach(guard => {
                select.innerHTML += `<option value="${guard.id}">${guard.firstName} ${guard.lastName}</option>`;
            });
        }

        // ÙØ±Ù…â€ŒÙ‡Ø§
        function setupForms() {
            // ÙØ±Ù… Ù…Ø­Ø§ÙØ¸
            document.getElementById('guardForm').addEventListener('submit', function(e) {
                e.preventDefault();
                if (currentEditId) {
                    updateGuard();
                } else {
                    addGuard();
                }
            });

            // ÙØ±Ù… Ø´ÛŒÙØª
            document.getElementById('shiftForm').addEventListener('submit', function(e) {
                e.preventDefault();
                addShift();
            });

            // ÙØ±Ù… Ø­Ø§Ø¯Ø«Ù‡
            document.getElementById('incidentForm').addEventListener('submit', function(e) {
                e.preventDefault();
                addIncident();
            });

            // ÙØ±Ù… Ù…Ø±Ø®ØµÛŒ
            document.getElementById('leaveForm').addEventListener('submit', function(e) {
                e.preventDefault();
                addLeave();
            });

            // Ø¯Ú©Ù…Ù‡ Ù„ØºÙˆ ÙˆÛŒØ±Ø§ÛŒØ´
            document.getElementById('cancelEdit').addEventListener('click', function() {
                cancelEdit();
            });
        }

        // ==================== Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ø­Ø§ÙØ¸Ø§Ù† ====================
        function addGuard() {
            // Ú†Ú© Ú©Ø±Ø¯Ù† Ø¯Ø³ØªØ±Ø³ÛŒ
            if (currentUser.role === 'guard') {
                alert('âŒ Ø´Ù…Ø§ Ø¯Ø³ØªØ±Ø³ÛŒ Ø§ÙØ²ÙˆØ¯Ù† Ù…Ø­Ø§ÙØ¸ Ø¬Ø¯ÛŒØ¯ Ø±Ø§ Ù†Ø¯Ø§Ø±ÛŒØ¯!');
                return;
            }

            const firstName = document.getElementById('firstName').value;
            const lastName = document.getElementById('lastName').value;
            const fatherName = document.getElementById('fatherName').value;
            const phone = document.getElementById('phoneNumber').value;
            const hireDate = document.getElementById('hireDate').value;
            const position = document.getElementById('position').value;
            const photoFile = document.getElementById('profilePhoto').files[0];

            if (!firstName || !lastName || !fatherName || !phone || !hireDate) {
                alert('âš ï¸ Ù„Ø·ÙØ§ ØªÙ…Ø§Ù… ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ø¶Ø±ÙˆØ±ÛŒ Ø±Ø§ Ù¾Ø± Ú©Ù†ÛŒØ¯!');
                return;
            }

            const newGuard = {
                id: guards.length > 0 ? Math.max(...guards.map(g => g.id)) + 1 : 1,
                firstName: firstName,
                lastName: lastName,
                fatherName: fatherName,
                phone: phone,
                hireDate: hireDate,
                position: position,
                profilePhoto: null
            };

            if (photoFile) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    newGuard.profilePhoto = e.target.result;
                    guards.push(newGuard);
                    saveAllData();
                    document.getElementById('guardForm').reset();
                    loadGuardsList();
                    alert('âœ… Ù…Ø­Ø§ÙØ¸ Ø¬Ø¯ÛŒØ¯ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø«Ø¨Øª Ø´Ø¯!');
                };
                reader.readAsDataURL(photoFile);
            } else {
                guards.push(newGuard);
                saveAllData();
                document.getElementById('guardForm').reset();
                loadGuardsList();
                alert('âœ… Ù…Ø­Ø§ÙØ¸ Ø¬Ø¯ÛŒØ¯ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø«Ø¨Øª Ø´Ø¯!');
            }
        }

        function editGuard(id) {
            // Ú†Ú© Ú©Ø±Ø¯Ù† Ø¯Ø³ØªØ±Ø³ÛŒ
            if (currentUser.role === 'guard') {
                alert('âŒ Ø´Ù…Ø§ Ø¯Ø³ØªØ±Ø³ÛŒ ÙˆÛŒØ±Ø§ÛŒØ´ Ù…Ø­Ø§ÙØ¸Ø§Ù† Ø±Ø§ Ù†Ø¯Ø§Ø±ÛŒØ¯!');
                return;
            }

            const guard = guards.find(g => g.id === id);
            if (!guard) return;

            document.getElementById('firstName').value = guard.firstName;
            document.getElementById('lastName').value = guard.lastName;
            document.getElementById('fatherName').value = guard.fatherName;
            document.getElementById('phoneNumber').value = guard.phone;
            document.getElementById('hireDate').value = guard.hireDate;
            document.getElementById('position').value = guard.position;

            document.querySelector('#guardForm button[type="submit"]').innerHTML = '<i class="fas fa-edit"></i> Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù…Ø­Ø§ÙØ¸';
            document.getElementById('cancelEdit').style.display = 'inline-block';
            
            currentEditId = id;
        }

        function updateGuard() {
            const guardIndex = guards.findIndex(g => g.id === currentEditId);
            if (guardIndex === -1) return;

            const photoFile = document.getElementById('profilePhoto').files[0];
            
            if (photoFile) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    guards[guardIndex].profilePhoto = e.target.result;
                    finishUpdate();
                };
                reader.readAsDataURL(photoFile);
            } else {
                finishUpdate();
            }

            function finishUpdate() {
                guards[guardIndex].firstName = document.getElementById('firstName').value;
                guards[guardIndex].lastName = document.getElementById('lastName').value;
                guards[guardIndex].fatherName = document.getElementById('fatherName').value;
                guards[guardIndex].phone = document.getElementById('phoneNumber').value;
                guards[guardIndex].hireDate = document.getElementById('hireDate').value;
                guards[guardIndex].position = document.getElementById('position').value;

                saveAllData();
                cancelEdit();
                loadGuardsList();
                alert('âœ… Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…Ø­Ø§ÙØ¸ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø´Ø¯!');
            }
        }

        function cancelEdit() {
            document.getElementById('guardForm').reset();
            document.querySelector('#guardForm button[type="submit"]').innerHTML = '<i class="fas fa-save"></i> Ø«Ø¨Øª Ù…Ø­Ø§ÙØ¸';
            document.getElementById('cancelEdit').style.display = 'none';
            currentEditId = null;
        }

        function loadGuardsList() {
            const container = document.getElementById('guardsList');
            container.innerHTML = '';

            if (guards.length === 0) {
                container.innerHTML = '<div class="alert alert-info">ğŸ“­ Ù‡ÛŒÚ† Ù…Ø­Ø§ÙØ¸ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</div>';
                return;
            }

            guards.forEach(guard => {
                const positionText = getPositionText(guard.position);
                const serviceYears = calculateServiceYears(guard.hireDate);
                
                let photoHTML = '<div class="profile-photo bg-light d-flex align-items-center justify-content-center"><i class="fas fa-user text-muted"></i></div>';
                
                if (guard.profilePhoto) {
                    photoHTML = `<img src="${guard.profilePhoto}" class="profile-photo" alt="Ø¹Ú©Ø³ Ù¾Ø±ÙˆÙØ§ÛŒÙ„">`;
                }

                const guardItem = document.createElement('div');
                guardItem.className = 'guard-item';
                guardItem.innerHTML = `
                    <div class="d-flex justify-content-between align-items-center">
                        <div class="d-flex align-items-center">
                            ${photoHTML}
                            <div class="me-3">
                                <h6 class="mb-1">${guard.firstName} ${guard.lastName}</h6>
                                <small class="text-muted">ğŸ“ ${guard.phone} | ğŸ“… ${guard.hireDate}</small>
                                <br>
                                <span class="badge bg-primary">${positionText}</span>
                                <span class="badge bg-secondary">${serviceYears} Ø³Ø§Ù„ Ø®Ø¯Ù…Øª</span>
                            </div>
                        </div>
                        <div>
                            ${currentUser.role !== 'guard' ? `
                                <button class="btn btn-sm btn-outline-primary" onclick="editGuard(${guard.id})">
                                    <i class="fas fa-edit"></i> ÙˆÛŒØ±Ø§ÛŒØ´
                                </button>
                                <button class="btn btn-sm btn-outline-danger" onclick="deleteGuard(${guard.id})">
                                    <i class="fas fa-trash"></i> Ø­Ø°Ù
                                </button>
                            ` : ''}
                        </div>
                    </div>
                `;
                
                guardItem.addEventListener('click', function(e) {
                    if (!e.target.closest('button')) {
                        showGuardDetails(guard.id);
                    }
                });
                
                container.appendChild(guardItem);
            });
        }

        function deleteGuard(id) {
            if (currentUser.role === 'guard') {
                alert('âŒ Ø´Ù…Ø§ Ø¯Ø³ØªØ±Ø³ÛŒ Ø­Ø°Ù Ù…Ø­Ø§ÙØ¸Ø§Ù† Ø±Ø§ Ù†Ø¯Ø§Ø±ÛŒØ¯!');
                return;
            }

            if (confirm('âš ï¸ Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ø§ÛŒÙ† Ù…Ø­Ø§ÙØ¸ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ')) {
                guards = guards.filter(guard => guard.id !== id);
                saveAllData();
                loadGuardsList();
                alert('ğŸ—‘ï¸ Ù…Ø­Ø§ÙØ¸ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø­Ø°Ù Ø´Ø¯!');
            }
        }

        function showGuardDetails(id) {
            const guard = guards.find(g => g.id === id);
            if (!guard) return;

            const positionText = getPositionText(guard.position);
            let photoHTML = '';
            if (guard.profilePhoto) {
                photoHTML = `<img src="${guard.profilePhoto}" style="width: 100px; height: 100px; border-radius: 50%; object-fit: cover; margin-bottom: 15px;" alt="Ø¹Ú©Ø³">`;
            }

            const detailHTML = `
                <div class="text-center">
                    ${photoHTML}
                    <h4>${guard.firstName} ${guard.lastName}</h4>
                    <p class="text-muted">Ù¾Ø³Ø± ${guard.fatherName}</p>
                </div>
                <div class="row mt-4">
                    <div class="col-md-6">
                        <p><strong>Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³:</strong> ${guard.phone}</p>
                        <p><strong>ØªØ§Ø±ÛŒØ® Ø§Ø³ØªØ®Ø¯Ø§Ù…:</strong> ${guard.hireDate}</p>
                    </div>
                    <div class="col-md-6">
                        <p><strong>Ø±ØªØ¨Ù‡:</strong> ${positionText}</p>
                        <p><strong>Ù…Ø¯Øª Ø®Ø¯Ù…Øª:</strong> ${calculateServiceYears(guard.hireDate)} Ø³Ø§Ù„</p>
                    </div>
                </div>
                <div class="mt-4">
                    <h5>ØªØ§Ø±ÛŒØ®Ú†Ù‡ ÙØ¹Ø§Ù„ÛŒØªâ€ŒÙ‡Ø§</h5>
                    <p>Ø´ÛŒÙØªâ€ŒÙ‡Ø§ÛŒ Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯Ù‡: ${shifts.filter(s => s.guardId === id).length}</p>
                    <p>Ø­ÙˆØ§Ø¯Ø« Ú¯Ø²Ø§Ø±Ø´ Ø´Ø¯Ù‡: ${incidents.filter(i => i.guardId === id).length}</p>
                    <p>Ù…Ø±Ø®ØµÛŒâ€ŒÙ‡Ø§ÛŒ Ú¯Ø±ÙØªÙ‡: ${leaves.filter(l => l.guardId === id).length}</p>
                </div>
            `;

            const modal = document.createElement('div');
            modal.className = 'modal-container';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h5>Ø¬Ø²Ø¦ÛŒØ§Øª Ú©Ø§Ù…Ù„ Ù…Ø­Ø§ÙØ¸</h5>
                        <button onclick="this.closest('.modal-container').remove()" style="background: none; border: none; font-size: 20px;">Ã—</button>
                    </div>
                    ${detailHTML}
                    <div class="mt-4 text-center">
                        <button class="btn btn-primary" onclick="printDetails()">
                            <i class="fas fa-print"></i> Ú†Ø§Ù¾
                        </button>
                        <button class="btn btn-secondary" onclick="this.closest('.modal-container').remove()">Ø¨Ø³ØªÙ†</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        // ==================== Ù…Ø¯ÛŒØ±ÛŒØª Ø´ÛŒÙØªâ€ŒÙ‡Ø§ ====================
        function loadShiftsSection() {
            // Ú†Ú© Ú©Ø±Ø¯Ù† Ø¯Ø³ØªØ±Ø³ÛŒ
            if (currentUser.role === 'guard') {
                document.getElementById('shiftForm').style.display = 'none';
                document.querySelector('#shifts h4').innerHTML = '<i class="fas fa-calendar-alt"></i> Ø´ÛŒÙØªâ€ŒÙ‡Ø§ÛŒ Ù…Ù†';
            }

            populateGuardDropdown('shiftGuard');
            loadShiftsList();
        }

        function addShift() {
            // Ú†Ú© Ú©Ø±Ø¯Ù† Ø¯Ø³ØªØ±Ø³ÛŒ
            if (currentUser.role === 'guard') {
                alert('âŒ Ø´Ù…Ø§ Ø¯Ø³ØªØ±Ø³ÛŒ Ø§ÙØ²ÙˆØ¯Ù† Ø´ÛŒÙØª Ø¬Ø¯ÛŒØ¯ Ø±Ø§ Ù†Ø¯Ø§Ø±ÛŒØ¯!');
                return;
            }

            const guardId = parseInt(document.getElementById('shiftGuard').value);
            const guard = guards.find(g => g.id === guardId);
            
            if (!guard) {
                alert('âš ï¸ Ù„Ø·ÙØ§Ù‹ ÛŒÚ© Ù…Ø­Ø§ÙØ¸ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯!');
                return;
            }

            const newShift = {
                id: shifts.length > 0 ? Math.max(...shifts.map(s => s.id)) + 1 : 1,
                guardId: guardId,
                guardName: guard.firstName + ' ' + guard.lastName,
                date: document.getElementById('shiftDate').value,
                startTime: document.getElementById('startTime').value,
                endTime: document.getElementById('endTime').value,
                type: document.getElementById('shiftType').value,
                status: 'Scheduled'
            };

            shifts.push(newShift);
            saveAllData();
            document.getElementById('shiftForm').reset();
            loadShiftsList();
            alert('âœ… Ø´ÛŒÙØª Ø¬Ø¯ÛŒØ¯ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø«Ø¨Øª Ø´Ø¯!');
        }

        function loadShiftsList() {
            const container = document.getElementById('shiftsList');
            container.innerHTML = '';

            const today = new Date().toISOString().split('T')[0];
            let todayShifts = shifts.filter(shift => shift.date === today);

            // Ø§Ú¯Ø± Ú©Ø§Ø±Ø¨Ø± Ù…Ø­Ø§ÙØ¸ Ø§Ø³ØªØŒ ÙÙ‚Ø· Ø´ÛŒÙØªâ€ŒÙ‡Ø§ÛŒ Ø®ÙˆØ¯Ø´ Ø±Ø§ Ø¨Ø¨ÛŒÙ†Ø¯
            if (currentUser.role === 'guard') {
                // Ø§ÛŒÙ†Ø¬Ø§ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ù…Ù†Ø·Ù‚ Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ Ù†Ù…Ø§ÛŒØ´ Ø´ÛŒÙØªâ€ŒÙ‡Ø§ÛŒ Ù…Ø­Ø§ÙØ¸ Ø®Ø§Øµ Ø±Ø§ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯
                todayShifts = todayShifts; // ÙØ¹Ù„Ø§Ù‹ Ù‡Ù…Ù‡ Ø±Ø§ Ù†Ø´Ø§Ù† Ù…ÛŒâ€ŒØ¯Ù‡Ø¯
            }

            if (todayShifts.length === 0) {
                container.innerHTML = '<div class="alert alert-info">ğŸ“­ Ù‡ÛŒÚ† Ø´ÛŒÙØªÛŒ Ø¨Ø±Ø§ÛŒ Ø§Ù…Ø±ÙˆØ² Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒØ±ÛŒØ²ÛŒ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</div>';
                return;
            }

            todayShifts.forEach(shift => {
                const shiftTypeClass = shift.type === 'Day' ? 'bg-warning' : 
                                     shift.type === 'Night' ? 'bg-dark' : 'bg-info';
                const shiftTypeText = shift.type === 'Day' ? 'Ø´ÛŒÙØª Ø±ÙˆØ²' : 
                                    shift.type === 'Night' ? 'Ø´ÛŒÙØª Ø´Ø¨' : 'Ø´ÛŒÙØª Ø±ÙˆØ² Ùˆ Ø´Ø¨';

                const shiftItem = document.createElement('div');
                shiftItem.className = 'shift-item';
                shiftItem.innerHTML = `
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="mb-1">${shift.guardName}</h6>
                            <small class="text-muted">ğŸ•’ ${shift.startTime} - ${shift.endTime}</small>
                            <br>
                            <span class="badge ${shiftTypeClass}">${shiftTypeText}</span>
                            <span class="badge bg-success">${shift.status}</span>
                        </div>
                        ${currentUser.role !== 'guard' ? `
                            <button class="btn btn-sm btn-outline-danger" onclick="deleteShift(${shift.id})">
                                <i class="fas fa-trash"></i> Ø­Ø°Ù
                            </button>
                        ` : ''}
                    </div>
                `;
                container.appendChild(shiftItem);
            });
        }

        function deleteShift(id) {
            if (currentUser.role === 'guard') {
                alert('âŒ Ø´Ù…Ø§ Ø¯Ø³ØªØ±Ø³ÛŒ Ø­Ø°Ù Ø´ÛŒÙØª Ø±Ø§ Ù†Ø¯Ø§Ø±ÛŒØ¯!');
                return;
            }

            if (confirm('âš ï¸ Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ø§ÛŒÙ† Ø´ÛŒÙØª Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ')) {
                shifts = shifts.filter(shift => shift.id !== id);
                saveAllData();
                loadShiftsList();
                alert('ğŸ—‘ï¸ Ø´ÛŒÙØª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø­Ø°Ù Ø´Ø¯!');
            }
        }

        // ==================== Ù…Ø¯ÛŒØ±ÛŒØª Ø­ÙˆØ§Ø¯Ø« ====================
        function loadIncidentsSection() {
            populateGuardDropdown('incidentGuard');
            loadIncidentsList();
        }

        function addIncident() {
            const guardId = parseInt(document.getElementById('incidentGuard').value);
            const guard = guards.find(g => g.id === guardId);
            
            const newIncident = {
                id: incidents.length > 0 ? Math.max(...incidents.map(i => i.id)) + 1 : 1,
                guardId: guardId,
                guardName: guard.firstName + ' ' + guard.lastName,
                dateTime: document.getElementById('incidentDateTime').value,
                title: document.getElementById('incidentTitle').value,
                description: document.getElementById('incidentDescription').value,
                severity: document.getElementById('incidentSeverity').value,
                status: 'Reported'
            };

            incidents.push(newIncident);
            saveAllData();
            document.getElementById('incidentForm').reset();
            loadIncidentsList();
            alert('ğŸš¨ Ø­Ø§Ø¯Ø«Ù‡ Ø¬Ø¯ÛŒØ¯ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø«Ø¨Øª Ø´Ø¯!');
        }

        function loadIncidentsList() {
            const container = document.getElementById('incidentsList');
            container.innerHTML = '';

            if (incidents.length === 0) {
                container.innerHTML = '<div class="alert alert-info">ğŸ“­ Ù‡ÛŒÚ† Ø­Ø§Ø¯Ø«Ù‡â€ŒØ§ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</div>';
                return;
            }

            incidents.forEach(incident => {
                const severityColors = {
                    'Low': 'success',
                    'Medium': 'warning', 
                    'High': 'danger',
                    'Critical': 'dark'
                };

                const incidentItem = document.createElement('div');
                incidentItem.className = 'incident-item';
                incidentItem.innerHTML = `
                    <div>
                        <h6 class="mb-1">${incident.title}</h6>
                        <small class="text-muted">ğŸ‘® ${incident.guardName} | ğŸ“… ${incident.dateTime}</small>
                        <p class="mt-2 mb-1">${incident.description}</p>
                        <span class="badge bg-${severityColors[incident.severity]}">
                            ${incident.severity === 'Low' ? 'Ú©Ù…' : 
                             incident.severity === 'Medium' ? 'Ù…ØªÙˆØ³Ø·' : 
                             incident.severity === 'High' ? 'Ø²ÛŒØ§Ø¯' : 'Ø¨Ø­Ø±Ø§Ù†ÛŒ'}
                        </span>
                        <span class="badge bg-info">${incident.status}</span>
                    </div>
                `;
                container.appendChild(incidentItem);
            });
        }

        // ==================== Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ø±Ø®ØµÛŒ ====================
        function loadLeavesSection() {
            populateGuardDropdown('leaveGuard');
            loadLeavesList();
        }

        function addLeave() {
            const guardId = parseInt(document.getElementById('leaveGuard').value);
            const guard = guards.find(g => g.id === guardId);
            
            const newLeave = {
                id: leaves.length > 0 ? Math.max(...leaves.map(l => l.id)) + 1 : 1,
                guardId: guardId,
                guardName: guard.firstName + ' ' + guard.lastName,
                startDate: document.getElementById('leaveStart').value,
                endDate: document.getElementById('leaveEnd').value,
                type: document.getElementById('leaveType').value,
                reason: document.getElementById('leaveReason').value,
                status: 'Pending'
            };

            leaves.push(newLeave);
            saveAllData();
            document.getElementById('leaveForm').reset();
            loadLeavesList();
            alert('ğŸ–ï¸ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù…Ø±Ø®ØµÛŒ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø«Ø¨Øª Ø´Ø¯!');
        }

        function loadLeavesList() {
            const container = document.getElementById('leavesList');
            container.innerHTML = '';

            if (leaves.length === 0) {
                container.innerHTML = '<div class="alert alert-info">ğŸ“­ Ù‡ÛŒÚ† Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù…Ø±Ø®ØµÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</div>';
                return;
            }

            leaves.forEach(leave => {
                const statusColors = {
                    'Pending': 'warning',
                    'Approved': 'success',
                    'Rejected': 'danger'
                };

                const statusTexts = {
                    'Pending': 'Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±',
                    'Approved': 'ØªØ§ÛŒÛŒØ¯ Ø´Ø¯Ù‡', 
                    'Rejected': 'Ø±Ø¯ Ø´Ø¯Ù‡'
                };

                const leaveItem = document.createElement('div');
                leaveItem.className = 'leave-item';
                leaveItem.innerHTML = `
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="mb-1">${leave.guardName}</h6>
                            <small class="text-muted">ğŸ“… ${leave.startDate} ØªØ§ ${leave.endDate}</small>
                            <br>
                            <span class="badge bg-info">
                                ${leave.type === 'Annual' ? 'Ø±ÙˆØ²Ø§Ù†Ù‡' : 
                                 leave.type === 'Sick' ? 'Ù…Ø±ÛŒØ¶ÛŒ' : 
                                 leave.type === 'Emergency' ? 'Ø§Ø¶Ø·Ø±Ø§Ø±ÛŒ' : 
                                 leave.type === 'Maternity' ? 'Ø²Ø§ÛŒÙ…Ø§Ù†' : 'Ù¾Ø¯Ø±ÛŒ'}
                            </span>
                            <span class="badge bg-${statusColors[leave.status]}">${statusTexts[leave.status]}</span>
                        </div>
                        <small>${leave.reason}</small>
                    </div>
                `;
                container.appendChild(leaveItem);
            });
        }

        // ==================== Ú¯Ø²Ø§Ø±Ø´Ø§Øª ====================
        function loadReportsSection() {
            document.getElementById('totalGuards').textContent = guards.length;
            
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('todayShifts').textContent = shifts.filter(s => s.date === today).length;
            
            document.getElementById('totalIncidents').textContent = incidents.length;
            document.getElementById('pendingLeaves').textContent = leaves.filter(l => l.status === 'Pending').length;

            document.getElementById('positionChart').innerHTML = `
                <p>ğŸ‘® Ø§ÙØ³Ø±: ${guards.filter(g => g.position === 'Officer').length} Ù†ÙØ±</p>
                <p>ğŸ–ï¸ Ø³Ø§ØªÙ†Ù…Ù†: ${guards.filter(g => g.position === 'Second_Lieutenant').length} Ù†ÙØ±</p>
                <p>â­ Ù„ÙˆÙ…Ú“ÛŒ Ø³Ø§ØªÙ†Ù…Ù†: ${guards.filter(g => g.position === 'First_Lieutenant').length} Ù†ÙØ±</p>
                <p>ğŸ”¹ Ø¯ÙˆÛŒÙ… Ø³Ø§ØªÙ†Ù…Ù†: ${guards.filter(g => g.position === 'Second_Lieutenant_Junior').length} Ù†ÙØ±</p>
                <p>ğŸ›¡ï¸ Ú«Ø§Ø±Ø¯: ${guards.filter(g => g.position === 'Guard').length} Ù†ÙØ±</p>
            `;

            document.getElementById('activityChart').innerHTML = `
                <p>âœ… Ø´ÛŒÙØªâ€ŒÙ‡Ø§ÛŒ Ø§Ù…Ø±ÙˆØ²: ${shifts.filter(s => s.date === today).length}</p>
                <p>ğŸš¨ Ø­ÙˆØ§Ø¯Ø« Ø«Ø¨Øª Ø´Ø¯Ù‡: ${incidents.length}</p>
                <p>ğŸ–ï¸ Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ Ù…Ø±Ø®ØµÛŒ: ${leaves.length}</p>
                <p>â³ Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± ØªØ§ÛŒÛŒØ¯: ${leaves.filter(l => l.status === 'Pending').length}</p>
            `;
        }

        // ==================== ØªÙˆØ§Ø¨Ø¹ Ú©Ù…Ú©ÛŒ ====================
        function getRoleText(role) {
            const roles = {
                'admin': 'Ø§Ø¯Ù…ÛŒÙ†',
                'manager': 'Ù…Ø¯ÛŒØ±',
                'guard': 'Ù…Ø­Ø§ÙØ¸'
            };
            return roles[role] || role;
        }

        function getPositionText(position) {
            const positions = {
                'Officer': 'Ø§ÙØ³Ø±',
                'Second_Lieutenant': 'Ø³Ø§ØªÙ†Ù…Ù†',
                'First_Lieutenant': 'Ù„ÙˆÙ…Ú“ÛŒ Ø³Ø§ØªÙ†Ù…Ù†', 
                'Second_Lieutenant_Junior': 'Ø¯ÙˆÛŒÙ… Ø³Ø§ØªÙ†Ù…Ù†',
                'Guard': 'Ú«Ø§Ø±Ø¯'
            };
            return positions[position] || position;
        }

        function calculateServiceYears(hireDate) {
            const hire = new Date(hireDate);
            const now = new Date();
            const years = now.getFullYear() - hire.getFullYear();
            return years > 0 ? years : 1;
        }

        function printDetails() {
            window.print();
        }

        function saveSettings() {
            if (currentUser.role !== 'admin') {
                alert('âŒ ÙÙ‚Ø· Ø§Ø¯Ù…ÛŒÙ† Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø±Ø§ ØªØºÛŒÛŒØ± Ø¯Ù‡Ø¯!');
                return;
            }
            alert('âœ… ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯!');
        }
    </script>
</body>
</html>
